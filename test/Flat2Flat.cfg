# Config file description:
#  test ECAL sequence: tcc hw input -> tp digi -> tcc hw input
#  check consistency of original and created tcc hardware input files

process TCCFlat2Flat = {
    
    include "FWCore/MessageLogger/data/MessageLogger.cfi"

    untracked PSet maxEvents = { untracked int32 input = 10 }

    source = EmptySource {}
    
    es_source tpparams = EmptyESSource {
	string recordName = "EcalTPParametersRcd"
	vuint32 firstValid = { 1 }
	bool iovIsRunNotTime = false
    }
    es_module = EcalTrigPrimESProducer {
	untracked string DatabaseFileEB = "TPG.txt"
	untracked string DatabaseFileEE = "TPG_EE.txt"
    }

    #-#-# Flat -> Digi  [create digis from input (set of) flat file(s)]
    include "SimCalorimetry/EcalElectronicsEmulation/data/EcalFEtoDigi.cfi"
    replace tccFlatToDigi.SuperModuleId  = -1
    replace tccFlatToDigi.FlatBaseName   = "data_in/ecal_tcc"
    replace tccFlatToDigi.SkipEvents     = 0
    replace tccFlatToDigi.UseIdentityLUT = false
    replace tccFlatToDigi.debugPrintFlag = false


    #-#-# Digi -> Flat
    include "SimCalorimetry/EcalElectronicsEmulation/data/EcalSimRawData.cfi"
    replace ecalSimRawData.tcc2dccData       = false
    replace ecalSimRawData.srp2dccData       = false
    replace ecalSimRawData.fe2dccData        = false
    replace ecalSimRawData.trigPrimProducer  = "tccFlatToDigi"
    replace ecalSimRawData.tcpDigiCollection = "formatTCP"
    replace ecalSimRawData.tpVerbose         = false
    replace ecalSimRawData.tccInDefaultVal   = 0 
    replace ecalSimRawData.tccNum            = -1
    replace ecalSimRawData.outputBaseName    = "data_out/ecal"

    #dump digi collections
    include "L1Trigger/HardwareValidation/data/L1Comparator.cfi"
    replace l1Compare.ETP_dataLabel = tccFlatToDigi
    replace l1Compare.ETP_emulLabel = tccFlatToDigi
    replace l1Compare.DumpFile      = "dump_flat.txt"
    replace l1Compare.DumpMode      = 1
    replace l1Compare.COMPARE_COLLS = { 1,0,0,0,0,0,0,0,0,0,0 }

    # schedule path    
    path p = { tccFlatToDigi, ecalSimRawData, l1Compare }
    
    module outputEvents = PoolOutputModule {
    	untracked string fileName = "ecalFlat2Flat.root"
    }
    endpath outpath = { outputEvents }
}
