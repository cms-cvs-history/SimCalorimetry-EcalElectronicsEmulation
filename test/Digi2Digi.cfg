# Config file description:
#  test ECAL sequence: tp digi -> tcc hw input -> tp digi
#  check consistency of input and output tp digi collections

process TCCDigi2Digi = {
    
    include "FWCore/MessageLogger/data/MessageLogger.cfi"

    source = PoolSource {
        untracked vstring fileNames = 
	{'file:file_mc.root'}
    }
    untracked PSet maxEvents = {untracked int32 input = 2}

    
    #-#-# ECAL TPG
    include "Geometry/EcalMapping/data/EcalMapping.cfi"
    include "MagneticField/Engine/data/volumeBasedMagneticField.cfi"
    include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"
    include "Geometry/CaloEventSetup/data/EcalTrigTowerConstituents.cfi"
    include "Geometry/CMSCommonData/data/cmsIdealGeometryXML.cfi"
    include "CalibCalorimetry/Configuration/data/Ecal_FakeConditions.cff"
    es_module = EcalTrigPrimESProducer {
    	untracked string DatabaseFileEB = "TPG.txt"
    	untracked string DatabaseFileEE = "TPG_EE.txt"
    }
    es_source tpparams = EmptyESSource {
    	string recordName = "EcalTPParametersRcd"
    	vuint32 firstValid = { 1 }
    	bool iovIsRunNotTime = false
    }
    include "Geometry/EcalMapping/data/EcalMapping.cfi"
    es_source eegeom = EmptyESSource {
    	string recordName = "EcalMappingRcd"
    	vuint32 firstValid = { 1 }
    	bool iovIsRunNotTime = false
    }
    include "SimCalorimetry/EcalTrigPrimProducers/data/ecalTriggerPrimitiveDigis.cfi"
    replace ecalTriggerPrimitiveDigis.TcpOutput  = true
    replace ecalTriggerPrimitiveDigis.BarrelOnly = true
    replace ecalTriggerPrimitiveDigis.Label      = "ecalDigis"
    replace ecalTriggerPrimitiveDigis.InstanceEB = "ebDigis"
    replace ecalTriggerPrimitiveDigis.InstanceEE = "eeDigis"
    replace ecalTriggerPrimitiveDigis.Debug      = false

    #-#-# Digi -> Flat
    include "SimCalorimetry/EcalElectronicsEmulation/data/EcalSimRawData.cfi"
    replace ecalSimRawData.tcc2dccData       = false
    replace ecalSimRawData.srp2dccData       = false
    replace ecalSimRawData.fe2dccData        = false
    replace ecalSimRawData.trigPrimProducer  = "ecalTriggerPrimitiveDigis"
    replace ecalSimRawData.tcpDigiCollection = "formatTCP"
    replace ecalSimRawData.tpVerbose         = false
    replace ecalSimRawData.tccInDefaultVal   = 0 
    replace ecalSimRawData.tccNum            = -1
    replace ecalSimRawData.outputBaseName    = "data/ecal"

    #-#-# Flat -> Digi
    include "SimCalorimetry/EcalElectronicsEmulation/data/EcalFEtoDigi.cfi"
    replace tccFlatToDigi.SuperModuleId   = -1
    replace tccFlatToDigi.FlatBaseName    = "data/ecal_tcc"
    replace tccFlatToDigi.FileEventOffset = 0

    #comparator
    include "L1Trigger/HardwareValidation/data/L1Comparator.cfi"
    //replace l1Compare.ETP_dataLabel = tccFlatToDigi:formatTCP
    //replace l1Compare.ETP_emulLabel = ecalTriggerPrimitiveDigis:formatTCP
    replace l1Compare.ETP_dataLabel = tccFlatToDigi
    replace l1Compare.ETP_emulLabel = ecalTriggerPrimitiveDigis
    replace l1Compare.DumpFile      = "dump_ecal.txt"
    replace l1Compare.DumpMode      = 1
    replace l1Compare.COMPARE_COLLS = { 1,0,0,0,0,0,0,0,0,0,0 }


    path p = { 
	ecalTriggerPrimitiveDigis,
	ecalSimRawData,
	tccFlatToDigi,
	l1Compare
    }
    
    module outputEvents = PoolOutputModule {
    	untracked string fileName = "ecalDigi2Digi.root"
    }
    endpath outpath = { outputEvents }
}
