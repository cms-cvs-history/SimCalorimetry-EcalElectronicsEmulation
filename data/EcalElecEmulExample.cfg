process EcalSimRawData = 
{	
  # input
   source = EcalSimpleSource {
 #number of events to generate:
       untracked int32 maxEvents = 2
 #xtal channel samples:
 #    pulse of 3 bx in gain 12 (ID=1, see 1<<12):
       string formula = "200+6.*((isample0==4)*.77+(isample0==5)*1.+(isample0==6)*.89)+1<<12"
 #TT samples:
 #  TT sample format:
 #        |11-9 |  8 |    7 - 0    |
 #        | TTF |fgvb|compressed Et|
 # 'S' every 3 TTs, 'C' every 7 TTs, events shifted by 1 TTs,
 # energy set to TT id in first event and then incremented at each event:
 #      string tpFormula = "itt0+ievt0 + max(((ieta0*72+iphi0+1+ievt0)%7==0)*3,((ieta0*72+iphi0+1+ievt0)%3==0)*1)<<9"
        string tpFormula = ""
        untracked bool verbose = false 
   }
 
  # TPG: defines the ecalTriggerPrimitiveDigis module
  include  "SimCalorimetry/EcalTrigPrimProducers/data/ecalTriggerPrimitiveDigis.cfi"
  replace ecalTriggerPrimitiveDigis.Label = "source"
  replace ecalTriggerPrimitiveDigis.InstanceEB = ""
  replace ecalTriggerPrimitiveDigis.InstanceEE = ""
  replace ecalTriggerPrimitiveDigis.TcpOutput = true 

  # SRP simulation:
  include "SimCalorimetry/EcalSelectiveReadoutProducers/data/ecalDigis.cfi"
  replace ecalDigis.digiProducer = "source"
  replace ecalDigis.dumpFlags = 10
  #replace ecalDigis.trigPrimBypass = false

  #simulation of raw data. Defines the ecalSimRawData module:
  include "SimCalorimetry/EcalElectronicsEmulation/data/EcalSimRawData.cfi"
  replace ecalSimRawData.unsuppressedDigiProducer = "source"
  #replace ecalSimRawData.trigPrimProducer = "source"

  # Geometry
  #
  include "Geometry/CMSCommonData/data/cmsSimIdealGeometryXML.cfi"

  # Calo geometry service model
  include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"

  # Description of EE trigger tower map
  include "Geometry/CaloEventSetup/data/EcalTrigTowerConstituents.cfi"

  path p = {  ecalTriggerPrimitiveDigis, ecalDigis, ecalSimRawData }
}
