process EcalSimRawData = {
  ######################################################################
  # input
  #
  source = EcalSimpleSource {
  # number of events to generate:
  untracked int32 maxEvents = 1

  # sim hits. Set to empty string for no sim hit.
  # Pattern example with energy set to (eta index in EB)*10MeV in first event 
  # and then incremented by 10MeV at each event:
  string simHitFormula = "(ieta0+ievt0)/100."

  #xtal channel digis. Set to empty string for no digis.
  # some realistic shape. Gain 12 (ID=1, see 1<<12). Every crystals with a 
  # 160 ADC count amplitude above a 200 ADC count baseline. 
  # string formula = "min(4095.,200+160.*((isample0==3)*.01+(isample0==4)*.76+(isample0==5)*1.+(isample0==6)*.89+(isample0==7)*.67+(isample0==8)*.47+(isample0==9)*.32))+1<<12"
  string formula = "" # no EBDigis
 
  #TT samples. Set to empy string for no TP digis.
  #  TT sample format:
  #        | 10 |    9 - 0    |
  #        |fgvb|      Et     |
  # Pattern example with energy set to TT id within SM in first event and then 
  # incremented at each event:
  # string tpFormula = "max(1023, itt0+ievt0)"
  string tpFormula = "" # no TP digis

  #verbosity switch:
  untracked bool verbose = false
  }
  #
  ######################################################################


  ######################################################################
  # Digitization
  #
  include "Configuration/StandardSequences/data/Digi.cff"
  include "Configuration/StandardSequences/data/MixingNoPileUp.cff"
 
  # TPG: defines the ecalTriggerPrimitiveDigis module
  include  "SimCalorimetry/EcalTrigPrimProducers/data/ecalTriggerPrimitiveDigis.cfi"

  # Gets hardcoded conditions the same used for standard digitization:
  es_source = EcalTrivialConditionRetriever {
  }

  # Module producing the digis to use for the TP emulator. Set to "source"
  #if the digis comes from the EcalSimpleSource, set to "ecalUnsuppressedDigis"
  #if it comes from the ecal digitization:
  #replace ecalTriggerPrimitiveDigis.Label = "source"
  replace ecalTriggerPrimitiveDigis.Label = "ecalUnsuppressedDigis"

  replace ecalTriggerPrimitiveDigis.InstanceEB = ""
  replace ecalTriggerPrimitiveDigis.InstanceEE = ""
  replace ecalTriggerPrimitiveDigis.TcpOutput = true 

  # SRP simulation:
  
  # Set ecalDigis.digiProducer to "source" if the digis are produced by the
  # EcalSimpleSource module, keep the default value otherwise:
  #replace ecalDigis.digiProducer = "source"

  replace ecalDigis.dumpFlags = 10
  replace ecalDigis.trigPrimBypass = false
  replace ecalDigis.writeSrFlags = true
  #
  ######################################################################

  ######################################################################
  # Simulation of raw data. Defines the ecalSimRawData module:
  #
  include "SimCalorimetry/EcalElectronicsEmulation/data/EcalSimRawData.cfi"

  # Set ecalSimRawData.unsuppressedDigiProducer to "source" if the digis
  # are produced by the EcalSimpleSource module, keep the default value
  # otherwise:
  #replace ecalSimRawData.unsuppressedDigiProducer = "source"

  # Set ecalSimRawData.trigPrimProducer to "source" if the TP digis
  # are produced by the EcalSimpleSource module, keep the default value
  # otherwise:
  #replace ecalSimRawData.trigPrimProducer = "source"
  #
  ######################################################################

  ######################################################################
  # Geometry
  #
  include "Geometry/CMSCommonData/data/cmsSimIdealGeometryXML.cfi"

  # Calo geometry service model
  include "Geometry/CaloEventSetup/data/CaloGeometry.cfi"

  # Description of EE trigger tower map
  include "Geometry/CaloEventSetup/data/EcalTrigTowerConstituents.cfi"
  #
  ######################################################################

  ######################################################################
  # Output
  #
  module out = PoolOutputModule {
    untracked string fileName = 'file:toto.root'
  }
  #
  ######################################################################
  
  ######################################################################
  # Path: modules to run.
  # If the source produces directlty the xtal digis, 'mix' and 
  # 'ecalUnsuppressedDigis' must be omitted. If the source produces the TPs, 
  # 'ecalTriggerPrimitiveDigis' must be omitted.
  path p = {  mix, ecalUnsuppressedDigis, ecalTriggerPrimitiveDigis, 
              ecalDigis, ecalSimRawData}

  endpath fine = { out }
  #
  ######################################################################
}
